<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bhagavad Gita Thoughts</title>
<style>
body {
  font-family: 'Georgia', serif;
  margin: 0; padding: 0;
  color: #333;
  background: linear-gradient(120deg, #ff9800, #ffb74d, #ffcc80);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  display: flex; flex-direction: column; align-items: center;
  overflow-x: hidden;
}
@keyframes gradientBG { 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }

header {
  background: rgba(139,0,0,0.8);
  color: gold;
  padding: 20px;
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  width: 100%;
  position: relative;
  display: flex; justify-content: center; align-items: center;
}

.menu-btn { position: absolute; right: 35px; top: 20px; cursor: pointer; width: 25px; height: 22px; display: flex; flex-direction: column; justify-content: space-between; }
.menu-btn div { height: 4px; background: gold; border-radius: 2px; transition: all 0.3s ease; }
.menu-btn.open div:nth-child(1){ transform: rotate(45deg) translate(5px,5px);}
.menu-btn.open div:nth-child(2){ opacity:0; }
.menu-btn.open div:nth-child(3){ transform: rotate(-45deg) translate(6px,-6px); }

.lang-menu { display: none; position: absolute; top: 60px; right: 45px; background: rgba(255,255,255,0.9); border-radius: 8px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.lang-menu button, .lang-menu a {
  display: block;
  width: 100%;
  margin: 5px 0;
  padding: 10px 10px;
  border: none;
  background: #8b0000;
  color: gold;
  border-radius: 6px;
  cursor: pointer;
  text-align: center;
  text-decoration: none;
  font-size: 14px;  /* same as buttons */
}
.feedbackBtn {
  width: 100px;        /* sets horizontal size */
  padding: 6px 6px;  /* vertical and horizontal padding */
  font-size: 16px;     /* size of text */
}

.lang-menu button:hover, .lang-menu a:hover {
  background: #a52a2a;
}

.history-btn { position: absolute; left: 20px; top: 20px; font-size: 24px; cursor: pointer; color: gold; background: none; border: none; transition: 0.3s; }
.history-btn:hover { transform: scale(1.2); }

.date-picker { display: none; position: absolute; left: 20px; top: 60px; background: rgba(255,255,255,0.95); padding: 8px; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }

.thought-card { background: rgba(255,250,240,0.9); margin: 50px auto 20px auto; padding: 25px; border-radius: 20px; width: 90%; max-width: 600px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); text-align: center; position: relative; }
.today-label { font-weight: bold; color: #8b0000; margin-bottom: 10px; font-size: 18px; }
.thought-text { font-size: 18px; margin-bottom: 15px; line-height: 1.6; }

.read-aloud { border: none; background: none; font-size: 24px; cursor: pointer; transition: 0.3s; }
.read-aloud:hover { transform: scale(1.3); }

.more-btn { display: inline-block; margin-top: 15px; padding: 8px 12px; border: none; background: #8b0000; color: gold; border-radius: 10px; cursor: pointer; transition: 0.3s; }
.more-btn:hover { background: #a52a2a; }

.details { display: none; margin-top: 10px; padding: 10px; background: #fff0e1; border-left: 4px solid #8b0000; border-radius: 10px; font-size: 16px; }

.thought-actions { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 15px; }
.like-btn, .comment-btn, .bookmark-btn, .share-btn, .meditate-btn { border: 2px solid black; background: none; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 16px; transition: 0.3s; }
.like-btn.liked { color: red; border-color: red; }
.comment-btn:hover, .bookmark-btn:hover, .share-btn:hover, .meditate-btn:hover { background: #ffe4b5; }

.comment-section { display: none; margin-top: 20px; padding: 10px; background: #f9f9f9; border-radius: 10px; border: 1px solid #ddd; }
.comment-section input { width: 80%; padding: 8px; margin-right: 5px; border-radius: 5px; border: 1px solid #ccc; }
.comment-section button { padding: 8px 12px; border: none; background: #8b0000; color: gold; border-radius: 5px; cursor: pointer; }

.comment { background: #fff; padding: 8px; margin: 6px 0; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ddd; font-size: 15px; }
.comment .like-comment { border: none; background: none; cursor: pointer; font-size: 14px; color: black; }
.comment .like-comment.liked { color: red; }

.om-symbol { font-size: 80px; color: gold; margin: 40px 0; animation: zoomAura 2s infinite alternate ease-in-out; }
@keyframes zoomAura { 0% { transform: scale(1); opacity: 0.7; } 50% { transform: scale(1.3); opacity: 1; } 100% { transform: scale(1); opacity: 0.7; } }

.streak { position: absolute; top: 20px; right: 5%; transform: translateX(-50%); background: gold; color: darkred; padding: 5px 12px; border-radius: 20px; font-weight: bold; }

.search-bar { margin: 10px 0; width: 90%; max-width: 600px; display: flex; justify-content: center; gap: 10px; }
.search-bar input { flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #8b0000; }
.search-bar button { padding: 8px 12px; border: none; background: #8b0000; color: gold; border-radius: 8px; cursor: pointer; }
.search-bar button:hover { background: #a52a2a; }
</style>
</head>
<body>

<header>
  üå∏ Bhagavad Gita Thoughts üå∏
  <button class="history-btn" onclick="toggleDatePicker()">üìú</button>
  <div class="menu-btn" id="menuBtn" onclick="toggleMenu()"><div></div><div></div><div></div></div>
  <div class="lang-menu" id="langMenu">
    <button onclick="showSubLangMenu()">Languages</button>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSe0EJ7hQ06ZdkQcRWHhBA7fCK0I0i1KbKBRGCg9xIt_fz755w/viewform?usp=header" target="_blank">Feedback</a>
  </div>
</header>

<div class="streak" id="streakCounter">Streak: 0</div>
<div class="date-picker" id="datePicker"><select id="selectedDate" onchange="changeDateThought()"></select></div>

<div class="search-bar">
  <input type="text" id="searchInput" placeholder="Search past thoughts...">
  <button onclick="searchThoughts()">üîç</button>
</div>

<div class="thought-card">
  <div class="today-label" id="todayLabel">Today's Thought</div>
  <div class="thought-text" id="thought">Loading...</div>
  <button class="read-aloud" onclick="readAloud()">üîä</button>
  <button class="more-btn" onclick="toggleDetails()">More</button>
  <div class="details" id="details"></div>
  <div class="thought-actions">
    <button class="like-btn" onclick="toggleLike(this)">‚ù§Ô∏è Like (<span id="likeCount">0</span>)</button>
    <button class="comment-btn" onclick="toggleComments()">üí¨ Comment</button>
    <button class="bookmark-btn" onclick="toggleBookmark()">üîñ Bookmark</button>
    <button class="share-btn" onclick="shareThought()">üîó Share</button>
    <button class="meditate-btn" onclick="toggleMeditation()">üïâÔ∏è Meditate</button>
  </div>
  <div class="comment-section" id="commentSection">
    <div><input type="text" id="commentInput" placeholder="Write a comment..."><button onclick="postComment()">Send</button></div>
    <div id="commentsList"></div>
  </div>
</div>

<div class="om-symbol">‡•ê</div>
<audio id="meditationAudio" loop>
  <source src="Meditation.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script type="module">
// ------------------- Firebase Modular SDK -------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getDatabase, ref, get, set, runTransaction } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWAsDI3_eptdgrnoXAbYSC4QyFv4Hlti8",
  authDomain: "radhekrishna-thoughts.firebaseapp.com",
  databaseURL: "https://radhekrishna-thoughts-default-rtdb.firebaseio.com",
  projectId: "radhekrishna-thoughts",
  storageBucket: "radhekrishna-thoughts.appspot.com",
  messagingSenderId: "910831854684",
  appId: "1:910831854684:web:b511870f918bc77bc43299",
  measurementId: "G-E8ZR1RBCFQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ------------------- Variables -------------------
let language = 'en';
let thoughts = {};
let availableDates = [];
let today = new Date().toISOString().split("T")[0];
let isMeditating = false;

// ------------------- Load CSV -------------------
fetch("Thoughts.csv")
  .then(res => res.text())
  .then(csv => {
    let rows = csv.split("\n").map(r => r.split(","));
    rows.shift();
    rows.forEach(row => {
      let [date, enThought, enDetails, enExample, hiThought, hiDetails, hiExample, guThought, guDetails, guExample] = row;
      thoughts[date] = {
        en: { thought: enThought, details: enDetails, example: enExample },
        hi: { thought: hiThought, details: hiDetails, example: hiExample },
        gu: { thought: guThought, details: guDetails, example: guExample }
      };
      availableDates.push(date);
    });

    const selectDate = document.getElementById("selectedDate");
    availableDates.forEach(date => {
      if (new Date(date) <= new Date()) {
        let opt = document.createElement("option");
        opt.value = date;
        opt.text = date===today?"Today":date;
        selectDate.appendChild(opt);
      }
    });
    selectDate.value = today;
    loadThought(today);
  })
  .catch(err => { document.getElementById("thought").innerText = "‚ö† Unable to load thoughts file."; console.error(err); });

// ------------------- Functions -------------------
function loadThought(date){
  if(thoughts[date] && thoughts[date][language]){
    let t = thoughts[date][language];
    document.getElementById("thought").innerText = t.thought;
    document.getElementById("details").innerHTML = `<p><b>Explanation:</b> ${t.details}</p><p><b>Real Life Example:</b> ${t.example}</p><button class="read-aloud" onclick="readDetails()">üîä</button>`;
    document.getElementById("todayLabel").innerText = (date===today)?"Today's Thought":`Thought for ${date}`;
    loadLikes(date);
    loadComments(date);
  } else {
    document.getElementById("thought").innerText = "No thought available for this date.";
    document.getElementById("details").innerHTML = "";
  }
}

async function loadLikes(date){
  const snap = await get(ref(db, 'likes/' + date));
  const count = snap.val() || 0;
  document.getElementById("likeCount").innerText = count;
}

function toggleLike(btn){
  const date = document.getElementById("selectedDate").value;
  runTransaction(ref(db, 'likes/' + date), current => (current || 0) + 1).then(()=> loadLikes(date));
}

async function loadComments(date){
  const commentsList = document.getElementById("commentsList");
  commentsList.innerHTML = '';
  const snap = await get(ref(db, 'comments/' + date));
  const comments = snap.val() || [];
  comments.forEach(c => {
    const div = document.createElement('div');
    div.className = 'comment';
    div.innerHTML = `<span>${c}</span>`;
    commentsList.appendChild(div);
  });
}

function toggleComments(){ 
  let section=document.getElementById("commentSection"); 
  section.style.display=section.style.display==='block'?'none':'block'; 
}

function postComment(){
  const input = document.getElementById("commentInput");
  const val = input.value.trim();
  if(val==='') return;

  const date = document.getElementById("selectedDate").value;
  const commentsRef = ref(db, 'comments/' + date);
  get(commentsRef).then(snap=>{
      const comments = snap.val() || [];
      comments.push(val);
      set(commentsRef, comments);
      input.value='';
      loadComments(date);
  });
}

function changeDateThought(){ loadThought(document.getElementById("selectedDate").value); }
function readAloud(){ let text=document.getElementById("thought").innerText; let speech=new SpeechSynthesisUtterance(text); speech.lang=language==='hi'?'hi-IN':language==='gu'?'gu-IN':'en-IN'; window.speechSynthesis.speak(speech); }
function readDetails(){ let date=document.getElementById("selectedDate").value; let t=thoughts[date][language]; let text=t.details+". "+t.example; let speech=new SpeechSynthesisUtterance(text); speech.lang=language==='hi'?'hi-IN':language==='gu'?'gu-IN':'en-IN'; window.speechSynthesis.speak(speech); }
function toggleDetails(){ let d=document.getElementById("details"); d.style.display=d.style.display==='block'?'none':'block'; }
function toggleMenu(){ let btn=document.getElementById("menuBtn"); btn.classList.toggle("open"); let menu=document.getElementById("langMenu"); menu.style.display=menu.style.display==='block'?'none':'block'; }

function showSubLangMenu(){ 
    const menu = document.getElementById("langMenu");
    menu.innerHTML = `
        <button id="langEn">English</button>
        <button id="langHi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        <button id="langGu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</button>
        <a id="feedbackBtn" href="https://docs.google.com/forms/d/e/1FAIpQLSe0EJ7hQ06ZdkQcRWHhBA7fCK0I0i1KbKBRGCg9xIt_fz755w/viewform?usp=header" target="_blank">Feedback</a>
    `;

    document.getElementById("langEn").addEventListener("click", () => setLanguage('en'));
    document.getElementById("langHi").addEventListener("click", () => setLanguage('hi'));
    document.getElementById("langGu").addEventListener("click", () => setLanguage('gu'));
}

function setLanguage(lang){ language=lang; changeDateThought(); showSubLangMenu(); document.getElementById("langMenu").style.display='none'; document.getElementById("menuBtn").classList.remove("open"); }
function toggleDatePicker(){ let dp=document.getElementById("datePicker"); dp.style.display=dp.style.display==='block'?'none':'block'; }
function toggleBookmark(){ let btn=document.querySelector(".bookmark-btn"); btn.classList.toggle("liked"); alert(btn.classList.contains("liked")?"Bookmarked!":"Removed from bookmarks!"); }
function shareThought(){ let text=document.getElementById("thought").innerText; if(navigator.share){ navigator.share({title:"Bhagavad Gita Thought",text:text}); } else { prompt("Copy this thought:",text); } }
function toggleMeditation() { const audio = document.getElementById("meditationAudio"); isMeditating = !isMeditating; if (isMeditating) audio.play(); else audio.pause(); }
let streak=localStorage.getItem('streak')||0; document.getElementById("streakCounter").innerText=`Streak: ${streak}`;
function searchThoughts(){ let query=document.getElementById("searchInput").value.toLowerCase(); let found=false; for(let date of availableDates){ if(new Date(date) <= new Date() && thoughts[date]['en'].thought.toLowerCase().includes(query)){ document.getElementById("selectedDate").value=date; loadThought(date); found=true; break; } } if(!found) alert("No matching thought found."); }

// ------------------- Expose functions globally -------------------
window.toggleLike = toggleLike;
window.toggleComments = toggleComments;
window.postComment = postComment;
window.toggleDetails = toggleDetails;
window.toggleMenu = toggleMenu;
window.showSubLangMenu = showSubLangMenu;
window.setLanguage = setLanguage;
window.toggleDatePicker = toggleDatePicker;
window.toggleBookmark = toggleBookmark;
window.shareThought = shareThought;
window.toggleMeditation = toggleMeditation;
window.readAloud = readAloud;
window.readDetails = readDetails;
window.changeDateThought = changeDateThought;
window.searchThoughts = searchThoughts;

</script>
</body>
</html>
